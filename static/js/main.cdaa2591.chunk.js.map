{"version":3,"sources":["config.js","RomLibrary.js","ListPage.js","ControlMapperRow.js","ControlsModal.js","FrameTimer.js","GamepadController.js","KeyboardController.js","Screen.js","utils.js","Speakers.js","Emulator.js","RunPage.js","App.js","index.js"],"names":["config","ROMS","owlia","name","description","react_default","a","createElement","href","target","url","nomolos","croom","lj65","GOOGLE_ANALYTICS_CODE","process","REACT_APP_GOOGLE_ANALYTICS_CODE","SENTRY_URI","REACT_APP_SENTRY_URI","RomLibrary","getRomInfoByHash","hash","this","load","find","rom","save","file","Promise","resolve","reject","reader","FileReader","onload","readAsBinaryString","pFileReader","then","readFile","byteString","result","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","crypto","subtle","digest","buffer","Array","from","map","b","toString","padStart","join","hashFile","_ref","savedRomInfo","localStorage","getItem","existingLibrary","JSON","parse","added","Date","now","newRomInfo","stringify","concat","setItem","delete","removeItem","filter","ListPage","props","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","deleteRom","updateLibrary","setState","romLibrary","handleDragOver","e","preventDefault","dataTransfer","dropEffect","handleDrop","items","getAsFile","files","history","push","pathname","state","_this2","className","onDragOver","onDrop","ListGroup","keys","sort","key","Link","to","encodeURIComponent","onClick","title","Component","ControlMapperRow","playerOneButton","playerTwoButton","waitingForKey","handleClick","bind","assertThisInitialized","button","playerButtons","console","log","prevProps","prevState","gamepadButton","newButton","searchButton","gamepadConfig","buttonId","buttons","searchNewButton","prevGamepadConfig","some","b2","waitingForKeyPlayer","gamepadButtonName","type","code","value","playerGamepadId","configs","prevButton","newState","currentPromptButton","player","buttonName","GAMEPAD_ICON","KEYBOARD_ICON","ControlsModal","undefined","modified","handleKeyDown","handleGamepadButtonDown","listenForKey","controllerIcon","gamepadId","controllerIconAlt","setKeys","setGamepadConfig","removeKeyListener","promptButton","document","addEventListener","buttonInfo","playerId","slice","newConfig","assign","event","newKeys","objectSpread","defineProperty","keyCode","toConsumableArray","String","toUpperCase","removeEventListener","Modal","isOpen","toggle","ModalHeader","ModalBody","Table","src","alt","src_ControlMapperRow","Controller","BUTTON_LEFT","BUTTON_SELECT","BUTTON_RIGHT","BUTTON_UP","BUTTON_DOWN","BUTTON_A","BUTTON_B","BUTTON_START","ModalFooter","Button","outline","color","FrameTimer","onAnimationFrame","calibrating","calibrationStartTime","getTime","calibrationCurrentFrames","calibrationFrames","fps","desiredFPS","calibrationTolerance","startBodgeMode","requestAnimationFrame","running","bodgeMode","onGenerateFrame","onWriteFrame","bodgeInterval","setInterval","onBodge","calibrationDelay","_requestID","window","cancelAnimationFrame","clearInterval","GamepadController","options","disableIfGamepadEnabled","callback","self","_getPlayerNumberFromGamepad","gamepad","id","poll","gamepads","navigator","getGamepads","webkitGetGamepads","usedPlayers","gamepadIndex","previousGamepad","gamepadState","previousButtons","buttonCallback","axes","axis","previousAxis","previousButton","pressed","playerNumber","indexOf","configButtons","configButton","onButtonDown","onButtonUp","f","loadGamepadConfig","startPolling","stop","stopped","loop","KEYS","88","89","90","17","13","38","40","37","39","103","105","99","97","104","98","100","102","KeyboardController","loadKeys","handleKeyUp","handleKeyPress","SCREEN_WIDTH","SCREEN_HEIGHT","Screen","setBuffer","y","x","buf32","writeBuffer","imageData","data","set","buf8","context","putImageData","fitInParent","parent","canvas","parentNode","parentWidth","clientWidth","parentHeight","clientHeight","desiredRatio","style","width","Math","round","height","handleMouseDown","onMouseDown","scale","parseFloat","rect","getBoundingClientRect","clientX","left","clientY","top","onMouseUp","ref","initCanvas","getContext","getImageData","fillStyle","fillRect","buf","Uint8ClampedArray","Uint32Array","img","Image","toDataURL","handleError","error","errorInfo","Raven","captureException","extra","Speakers","onBufferUnderrun","writeSample","right","size","bufferSize","enq","onaudioprocess","outputBuffer","getChannelData","samples","deqN","j","RingBuffer","AudioContext","audioCtx","scriptNode","createScriptProcessor","connect","destination","disconnect","close","catch","Emulator","start","frameTimer","speakers","fpsInterval","nes","getFPS","src_Screen_0","screen","frame","zapperMove","zapperFireDown","zapperFireUp","_this3","actualSize","desiredSize","paused","NES","onFrame","onStatusUpdate","onAudioSample","wrap","gamepadController","buttonDown","buttonUp","gamepadPolling","keyboardController","loadROM","romData","RunPage","match","params","slug","isLocalROM","test","romHash","split","romInfo","romName","localROMData","handleLoaded","currentRequest","path","handleProgress","req","XMLHttpRequest","open","overrideMimeType","status","responseText","Error","statusText","onerror","onprogress","send","loadBinary","err","message","location","lengthComputable","loadedPercent","loaded","total","loading","handlePauseResume","layout","navbarHeight","getComputedStyle","navbar","screenContainer","innerHeight","emulator","toggleControlsModal","controlsModalOpen","el","disabled","Progress","position","src_Emulator","src_ControlsModal","abort","App","recordPageview","GoogleAnalytics","pageview","initialize","BrowserRouter","Route","exact","component","render","install","ReactDOM","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.cdaa2591.chunk.js","sourcesContent":["import React from \"react\";\r\n\r\nconst config = {\r\n  ROMS: {\r\n    owlia: {\r\n      name: \"The Legends of Owlia\",\r\n      description: (\r\n        <span>\r\n          <a\r\n            href=\"http://www.gradualgames.com/p/the-legends-of-owlia_1.html\"\r\n            target=\"_blank\"\r\n          >\r\n            Owlia by Gradual Games\r\n          </a>{\" \"}\r\n          /{\" \"}\r\n          <a href=\"http://www.infiniteneslives.com/owlia.php\" target=\"_blank\">\r\n            Buy the cartridge\r\n          </a>\r\n        </span>\r\n      ),\r\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/owlia.nes\"\r\n    },\r\n    nomolos: {\r\n      name: \"Nomolos: Storming the Catsle\",\r\n      description: (\r\n        <span>\r\n          <a\r\n            href=\"http://www.gradualgames.com/p/nomolos-storming-catsle.html\"\r\n            target=\"_blank\"\r\n          >\r\n            Monolos by Gradual Games\r\n          </a>{\" \"}\r\n          /{\" \"}\r\n          <a href=\"http://www.infiniteneslives.com/nomolos.php\" target=\"_blank\">\r\n            Buy the cartridge\r\n          </a>\r\n        </span>\r\n      ),\r\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/nomolos.nes\"\r\n    },\r\n    croom: {\r\n      name: \"Concentration Room\",\r\n      description: (\r\n        <span>\r\n          <a href=\"http://www.pineight.com/croom/README\" target=\"_blank\">\r\n            Concentration Room\r\n          </a>{\" \"}\r\n          by Damian Yerrick\r\n        </span>\r\n      ),\r\n      url:\r\n        \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/croom/croom.nes\"\r\n    },\r\n    lj65: {\r\n      name: \"LJ65\",\r\n      description: (\r\n        <span>\r\n          <a href=\"http://harddrop.com/wiki/LJ65\" target=\"_blank\">\r\n            Concentration Room\r\n          </a>{\" \"}\r\n          by Damian Yerrick\r\n        </span>\r\n      ),\r\n      url: \"https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/lj65/lj65.nes\"\r\n    }\r\n  },\r\n  GOOGLE_ANALYTICS_CODE: process.env.REACT_APP_GOOGLE_ANALYTICS_CODE,\r\n  SENTRY_URI: process.env.REACT_APP_SENTRY_URI\r\n};\r\n\r\nexport default config;\r\n","const pFileReader = function(file) {\r\n  return new Promise((resolve, reject) => {\r\n    var reader = new FileReader();\r\n    reader.onload = resolve;\r\n    reader.readAsBinaryString(file);\r\n  });\r\n};\r\n\r\nconst hashFile = function(byteString) {\r\n  const asHex = buffer => {\r\n    return Array.from(new Uint8Array(buffer))\r\n      .map(b => b.toString(16).padStart(2, \"0\"))\r\n      .join(\"\");\r\n  };\r\n\r\n  const ab = new ArrayBuffer(byteString.length);\r\n  var ia = new Uint8Array(ab);\r\n\r\n  for (var i = 0; i < byteString.length; i++) {\r\n    ia[i] = byteString.charCodeAt(i);\r\n  }\r\n\r\n  return crypto.subtle.digest(\"SHA-1\", ab).then(asHex);\r\n};\r\n\r\nconst RomLibrary = {\r\n  getRomInfoByHash: function(hash) {\r\n    return this.load().find(rom => rom.hash === hash);\r\n  },\r\n  save: function(file) {\r\n    return pFileReader(file)\r\n      .then(function(readFile) {\r\n        const byteString = readFile.target.result;\r\n        return hashFile(byteString).then(hash => {\r\n          return { hash, byteString };\r\n        });\r\n      })\r\n      .then(({ hash, byteString }) => {\r\n        const savedRomInfo = localStorage.getItem(\"savedRomInfo\");\r\n        const existingLibrary = savedRomInfo ? JSON.parse(savedRomInfo) : [];\r\n\r\n        const rom = {\r\n          name: file.name,\r\n          hash: hash,\r\n          added: Date.now()\r\n        };\r\n\r\n        const newRomInfo = JSON.stringify(existingLibrary.concat([rom]));\r\n\r\n        localStorage.setItem(\"savedRomInfo\", newRomInfo);\r\n        localStorage.setItem(\"blob-\" + hash, byteString);\r\n\r\n        return rom;\r\n      });\r\n  },\r\n  load: function() {\r\n    const localData = localStorage.getItem(\"savedRomInfo\");\r\n    if (!localData) return [];\r\n    const savedRomInfo = JSON.parse(localStorage.getItem(\"savedRomInfo\"));\r\n    return savedRomInfo || [];\r\n  },\r\n  delete: function(hash) {\r\n    const existingLibrary = this.load();\r\n    localStorage.removeItem(\"blob-\" + hash);\r\n    localStorage.setItem(\r\n      \"savedRomInfo\",\r\n      JSON.stringify(existingLibrary.filter(rom => rom.hash !== hash))\r\n    );\r\n  }\r\n};\r\n\r\nexport default RomLibrary;\r\n","import React, { Component } from \"react\";\r\nimport \"./ListPage.css\";\r\nimport { ListGroup, Button } from \"reactstrap\";\r\nimport { Link } from \"react-router-dom\";\r\nimport config from \"./config\";\r\n\r\nimport RomLibrary from \"./RomLibrary\";\r\n\r\nclass ListPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      romLibrary: RomLibrary.load()\r\n    };\r\n  }\r\n  render() {\r\n    return (\r\n      <div\r\n        className=\"container ListPage my-4\"\r\n        onDragOver={this.handleDragOver}\r\n        onDrop={this.handleDrop}\r\n      >\r\n        <div className=\"row justify-content-center\">\r\n          <div className=\"col-md-8\">\r\n            <header className=\"mb-4\">\r\n              <h1 className=\"mb-3\">JSNES</h1>\r\n              <p>\r\n                A JavaScript NES emulator.{\" \"}\r\n                <a href=\"https://github.com/bfirsh/jsnes\">Source on GitHub.</a>\r\n              </p>\r\n            </header>\r\n\r\n            <ListGroup className=\"mb-4\">\r\n              {Object.keys(config.ROMS)\r\n                .sort()\r\n                .map(key => (\r\n                  <Link\r\n                    key={key}\r\n                    to={\"/run/\" + encodeURIComponent(key)}\r\n                    className=\"list-group-item\"\r\n                  >\r\n                    {config.ROMS[key][\"name\"]}\r\n                    <span className=\"float-right\">&rsaquo;</span>\r\n                  </Link>\r\n                ))}\r\n            </ListGroup>\r\n\r\n            <p>\r\n              Or, drag and drop a ROM file onto the page to play it. (Google may\r\n              help you find them.)\r\n            </p>\r\n\r\n            {this.state.romLibrary.length > 0 ? (\r\n              <div>\r\n                <p>Previously played:</p>\r\n\r\n                <ListGroup className=\"mb-4\">\r\n                  {this.state.romLibrary\r\n                    .sort((a, b) => new Date(b.added) - new Date(a.added))\r\n                    .map(rom => (\r\n                      <Link\r\n                        key={rom.hash}\r\n                        to={\"run/local-\" + rom.hash}\r\n                        className=\"list-group-item\"\r\n                      >\r\n                        {rom.name}\r\n                        <a\r\n                          onClick={e => {\r\n                            e.preventDefault();\r\n                            this.deleteRom(rom.hash);\r\n                          }}\r\n                          className=\"delete\"\r\n                          title=\"Delete\"\r\n                        >\r\n                          &times;\r\n                        </a>\r\n                        <span className=\"float-right\">&rsaquo;</span>\r\n                      </Link>\r\n                    ))}\r\n                </ListGroup>\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  deleteRom = hash => {\r\n    RomLibrary.delete(hash);\r\n    this.updateLibrary();\r\n  };\r\n\r\n  updateLibrary = () => {\r\n    this.setState({ romLibrary: RomLibrary.load() });\r\n  };\r\n\r\n  handleDragOver = e => {\r\n    e.preventDefault();\r\n    e.dataTransfer.dropEffect = \"copy\";\r\n  };\r\n\r\n  handleDrop = e => {\r\n    e.preventDefault();\r\n\r\n    const file = e.dataTransfer.items\r\n      ? e.dataTransfer.items[0].getAsFile()\r\n      : e.dataTransfer.files[0];\r\n\r\n    RomLibrary.save(file).then(rom => {\r\n      this.updateLibrary();\r\n      this.props.history.push({ pathname: \"run/local-\" + rom.hash });\r\n    });\r\n  };\r\n}\r\n\r\nexport default ListPage;\r\n","import React, { Component } from \"react\";\r\n\r\nclass ControlMapperRow extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      playerOneButton: \"\",\r\n      playerTwoButton: \"\",\r\n      waitingForKey: 0\r\n    };\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    var keys = this.props.keys;\r\n    var button = this.props.button;\r\n    var playerButtons = [];\r\n    for (var key in keys) {\r\n      if (keys[key][0] === 1 && keys[key][1] === button) {\r\n        playerButtons[0] = keys[key][2];\r\n        console.log(playerButtons[0]);\r\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\r\n        playerButtons[1] = keys[key][2];\r\n      }\r\n    }\r\n    this.setState({\r\n      playerOneButton: playerButtons[0],\r\n      playerTwoButton: playerButtons[1]\r\n    });\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    var keys = this.props.keys;\r\n    var button = this.props.button;\r\n    var playerButtons = [];\r\n    var gamepadButton;\r\n    var newButton;\r\n\r\n    for (var key in keys) {\r\n      if (keys[key][0] === 1 && keys[key][1] === button) {\r\n        playerButtons[0] = keys[key][2];\r\n        console.log(playerButtons[0]);\r\n      } else if (keys[key][0] === 2 && keys[key][1] === button) {\r\n        playerButtons[1] = keys[key][2];\r\n      }\r\n    }\r\n\r\n    var searchButton = (gamepadConfig, buttonId) => {\r\n      return gamepadConfig.buttons.filter(b => b.buttonId === buttonId)[0];\r\n    };\r\n\r\n    var searchNewButton = (prevGamepadConfig, gamepadConfig) => {\r\n      return gamepadConfig.buttons.filter(b => {\r\n        return (\r\n          !prevGamepadConfig ||\r\n          !prevGamepadConfig.buttons.some(b2 => b2.buttonId === b.buttonId)\r\n        );\r\n      })[0];\r\n    };\r\n\r\n    var waitingForKey = 0;\r\n    var waitingForKeyPlayer = 0;\r\n\r\n    var gamepadButtonName = gamepadButton => {\r\n      if (gamepadButton.type === \"button\") return \"Btn-\" + gamepadButton.code;\r\n      if (gamepadButton.type === \"axis\")\r\n        return \"Axis-\" + gamepadButton.code + \" \" + gamepadButton.value;\r\n    };\r\n\r\n    if (this.props.gamepadConfig && this.props.gamepadConfig.playerGamepadId) {\r\n      const playerGamepadId = this.props.gamepadConfig.playerGamepadId;\r\n      if (playerGamepadId[0]) {\r\n        playerButtons[0] = \"\";\r\n        gamepadButton = searchButton(\r\n          this.props.gamepadConfig.configs[playerGamepadId[0]],\r\n          button\r\n        );\r\n        newButton = searchNewButton(\r\n          prevProps.gamepadConfig.configs[playerGamepadId[0]],\r\n          this.props.gamepadConfig.configs[playerGamepadId[0]]\r\n        );\r\n        if (gamepadButton) {\r\n          playerButtons[0] = gamepadButtonName(gamepadButton);\r\n        } else {\r\n          if (newButton && newButton.buttonId === this.props.prevButton) {\r\n            if (!waitingForKey) {\r\n              waitingForKey = 1;\r\n              waitingForKeyPlayer = 1;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (playerGamepadId[1]) {\r\n        playerButtons[1] = \"\";\r\n        gamepadButton = searchButton(\r\n          this.props.gamepadConfig.configs[playerGamepadId[1]],\r\n          button\r\n        );\r\n        newButton = searchNewButton(\r\n          prevProps.gamepadConfig.configs[playerGamepadId[1]],\r\n          this.props.gamepadConfig.configs[playerGamepadId[1]]\r\n        );\r\n        if (gamepadButton) {\r\n          playerButtons[1] = gamepadButtonName(gamepadButton);\r\n        } else {\r\n          if (newButton && newButton.buttonId === this.props.prevButton) {\r\n            if (!waitingForKey) {\r\n              waitingForKey = 2;\r\n              waitingForKeyPlayer = 2;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    var newState = {};\r\n\r\n    if (waitingForKey) {\r\n      this.props.handleClick([waitingForKeyPlayer, this.props.button]);\r\n    }\r\n    // Prevent setState being called repeatedly\r\n    if (\r\n      prevState.playerOneButton !== playerButtons[0] ||\r\n      prevState.playerTwoButton !== playerButtons[1]\r\n    ) {\r\n      newState.playerOneButton = playerButtons[0];\r\n      newState.playerTwoButton = playerButtons[1];\r\n    }\r\n\r\n    if (waitingForKey) {\r\n      newState.waitingForKey = waitingForKey;\r\n    } else if (prevState.waitingForKey === 1) {\r\n      if (this.props.currentPromptButton !== this.props.button) {\r\n        newState.waitingForKey = 0;\r\n      }\r\n    } else if (prevState.waitingForKey === 2) {\r\n      if (this.props.currentPromptButton !== this.props.button) {\r\n        newState.waitingForKey = 0;\r\n      }\r\n    }\r\n\r\n    if (Object.keys(newState).length > 0) {\r\n      this.setState(newState);\r\n    }\r\n  }\r\n\r\n  handleClick(player) {\r\n    this.props.handleClick([player, this.props.button]);\r\n    this.setState({\r\n      waitingForKey: player\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const waitingText = \"Press key or button...\";\r\n    return (\r\n      <tr>\r\n        <td>{this.props.buttonName}</td>\r\n        <td onClick={() => this.handleClick(1)}>\r\n          {this.state.waitingForKey === 1\r\n            ? waitingText\r\n            : this.state.playerOneButton}\r\n        </td>\r\n        <td onClick={() => this.handleClick(2)}>\r\n          {this.state.waitingForKey === 2\r\n            ? waitingText\r\n            : this.state.playerTwoButton}\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ControlMapperRow;\r\n","import React, { Component } from \"react\";\r\nimport {\r\n  Button,\r\n  Modal,\r\n  ModalHeader,\r\n  ModalBody,\r\n  ModalFooter,\r\n  Table\r\n} from \"reactstrap\";\r\nimport { Controller } from \"jsnes\";\r\nimport ControlMapperRow from \"./ControlMapperRow\";\r\n\r\nconst GAMEPAD_ICON = \"../img/nes_controller.png\";\r\nconst KEYBOARD_ICON = \"../img/keyboard.png\";\r\n\r\nclass ControlsModal extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      gamepadConfig: props.gamepadConfig,\r\n      keys: props.keys,\r\n      button: undefined,\r\n      modified: false\r\n    };\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.handleGamepadButtonDown = this.handleGamepadButtonDown.bind(this);\r\n    this.listenForKey = this.listenForKey.bind(this);\r\n\r\n    this.state.gamepadConfig = this.state.gamepadConfig || {};\r\n    this.state.gamepadConfig.playerGamepadId = this.state.gamepadConfig\r\n      .playerGamepadId || [null, null];\r\n    this.state.gamepadConfig.configs = this.state.gamepadConfig.configs || {};\r\n\r\n    this.state.controllerIcon = this.state.gamepadConfig.playerGamepadId.map(\r\n      gamepadId => (gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON)\r\n    );\r\n    this.state.controllerIconAlt = this.state.gamepadConfig.playerGamepadId.map(\r\n      gamepadId => (gamepadId ? \"gamepad\" : \"keyboard\")\r\n    );\r\n    this.state.currentPromptButton = -1;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.state.modified) {\r\n      this.props.setKeys(this.state.keys);\r\n      this.props.setGamepadConfig(this.state.gamepadConfig);\r\n    }\r\n    this.removeKeyListener();\r\n  }\r\n\r\n  listenForKey(button) {\r\n    var currentPromptButton = button[1];\r\n\r\n    this.removeKeyListener();\r\n    this.setState({ button, currentPromptButton });\r\n    this.props.promptButton(this.handleGamepadButtonDown);\r\n    document.addEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  handleGamepadButtonDown(buttonInfo) {\r\n    this.removeKeyListener();\r\n\r\n    var button = this.state.button;\r\n\r\n    const playerId = button[0];\r\n    const buttonId = button[1];\r\n\r\n    const gamepadId = buttonInfo.gamepadId;\r\n    const gamepadConfig = this.state.gamepadConfig;\r\n\r\n    // link player to gamepad\r\n    const playerGamepadId = gamepadConfig.playerGamepadId.slice(0);\r\n    const newConfig = {};\r\n\r\n    playerGamepadId[playerId - 1] = gamepadId;\r\n\r\n    const rejectButtonId = b => {\r\n      return b.buttonId !== buttonId;\r\n    };\r\n\r\n    const newButton = {\r\n      code: buttonInfo.code,\r\n      type: buttonInfo.type,\r\n      buttonId: buttonId,\r\n      value: buttonInfo.value\r\n    };\r\n    newConfig[gamepadId] = {\r\n      buttons: (gamepadConfig.configs[gamepadId] || { buttons: [] }).buttons\r\n        .filter(rejectButtonId)\r\n        .concat([newButton])\r\n    };\r\n\r\n    const configs = Object.assign({}, gamepadConfig.configs, newConfig);\r\n\r\n    this.setState({\r\n      gamepadConfig: {\r\n        configs: configs,\r\n        playerGamepadId: playerGamepadId\r\n      },\r\n      currentPromptButton: -1,\r\n      controllerIcon: playerGamepadId.map(gamepadId =>\r\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\r\n      ),\r\n      modified: true\r\n    });\r\n  }\r\n\r\n  handleKeyDown(event) {\r\n    this.removeKeyListener();\r\n\r\n    var button = this.state.button;\r\n    var keys = this.state.keys;\r\n    var newKeys = {};\r\n    for (var key in keys) {\r\n      if (keys[key][0] !== button[0] || keys[key][1] !== button[1]) {\r\n        newKeys[key] = keys[key];\r\n      }\r\n    }\r\n\r\n    const playerGamepadId = this.state.gamepadConfig.playerGamepadId.slice(0);\r\n    const playerId = button[0];\r\n    playerGamepadId[playerId - 1] = null;\r\n\r\n    this.setState({\r\n      keys: {\r\n        ...newKeys,\r\n        [event.keyCode]: [\r\n          ...button.slice(0, 2),\r\n          event.key.length > 1 ? event.key : String(event.key).toUpperCase()\r\n        ]\r\n      },\r\n      button: undefined,\r\n      gamepadConfig: {\r\n        configs: this.state.gamepadConfig.configs,\r\n        playerGamepadId: playerGamepadId\r\n      },\r\n      currentPromptButton: -1,\r\n      controllerIcon: playerGamepadId.map(gamepadId =>\r\n        gamepadId ? GAMEPAD_ICON : KEYBOARD_ICON\r\n      ),\r\n      controllerIconAlt: playerGamepadId.map(gamepadId =>\r\n        gamepadId ? \"gamepad\" : \"keyboard\"\r\n      ),\r\n      modified: true\r\n    });\r\n  }\r\n\r\n  removeKeyListener() {\r\n    this.props.promptButton(null);\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        isOpen={this.props.isOpen}\r\n        toggle={this.props.toggle}\r\n        className=\"ControlsModal\"\r\n      >\r\n        <ModalHeader toggle={this.props.toggle}>Controls</ModalHeader>\r\n        <ModalBody>\r\n          <Table>\r\n            <thead>\r\n              <tr>\r\n                <th>Button</th>\r\n                <th>\r\n                  Player 1\r\n                  <img\r\n                    className=\"controller-icon\"\r\n                    src={this.state.controllerIcon[0]}\r\n                    alt={this.state.controllerIconAlt[0]}\r\n                  />\r\n                </th>\r\n                <th>\r\n                  Player 2\r\n                  <img\r\n                    className=\"controller-icon\"\r\n                    src={this.state.controllerIcon[1]}\r\n                    alt={this.state.controllerIconAlt[1]}\r\n                  />\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <ControlMapperRow\r\n                buttonName=\"Left\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_LEFT}\r\n                prevButton={Controller.BUTTON_SELECT}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"Right\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_RIGHT}\r\n                prevButton={Controller.BUTTON_LEFT}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"Up\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_UP}\r\n                prevButton={Controller.BUTTON_RIGHT}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"Down\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_DOWN}\r\n                prevButton={Controller.BUTTON_UP}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"A\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_A}\r\n                prevButton={Controller.BUTTON_DOWN}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"B\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_B}\r\n                prevButton={Controller.BUTTON_A}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"Start\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_START}\r\n                prevButton={Controller.BUTTON_B}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n              <ControlMapperRow\r\n                buttonName=\"Select\"\r\n                currentPromptButton={this.state.currentPromptButton}\r\n                button={Controller.BUTTON_SELECT}\r\n                prevButton={Controller.BUTTON_START}\r\n                keys={this.state.keys}\r\n                handleClick={this.listenForKey}\r\n                gamepadConfig={this.state.gamepadConfig}\r\n              />\r\n            </tbody>\r\n          </Table>\r\n        </ModalBody>\r\n        <ModalFooter>\r\n          <Button outline color=\"primary\" onClick={this.props.toggle}>\r\n            Close\r\n          </Button>\r\n        </ModalFooter>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ControlsModal;\r\n","// FrameTimer is two timers: one which triggers at 60 FPS, and the other which\r\n// triggers whenever there is an animation frame.\r\n//\r\n// Normally, the animation frame is 60 FPS, but if it isn't, we need to\r\n// bodge it by setting up another timer.\r\n//\r\n// Why not just use the bodge all the time? If the animation frame is 60 FPS,\r\n// then it is a much more accurate timer than setInterval. Also, two timers\r\n// will sometimes be out of sync, causing missed frames.\r\nexport default class FrameTimer {\r\n  constructor(props) {\r\n    // Run at 60 FPS\r\n    this.onGenerateFrame = props.onGenerateFrame;\r\n    // Run on animation frame\r\n    this.onWriteFrame = props.onWriteFrame;\r\n\r\n    // Whether to fire events or not\r\n    this.running = false;\r\n\r\n    // Bodge mode and calibration\r\n    this.bodgeMode = false;\r\n\r\n    // Calibration config\r\n    this.desiredFPS = 60;\r\n    this.calibrationDelay = 200; // time to wait before starting\r\n    this.calibrationFrames = 10; // number of frames to calibrate with\r\n    this.calibrationTolerance = 5; // +/- desired FPS to consider correct\r\n\r\n    // Calibration state\r\n    this.calibrating = false;\r\n    this.calibrationStartTime = null;\r\n    this.calibrationCurrentFrames = null;\r\n\r\n    // FIXME: disable bodge mode entirely. it's not really working.\r\n    // if (window.requestAnimationFrame) {\r\n    //   // wait a sec for it to settle down\r\n    //   setTimeout(() => {\r\n    //     this.calibrating = true;\r\n    //   }, this.calibrationDelay);\r\n    // } else {\r\n    //   console.log(\"requestAnimationFrame is not supported\");\r\n    // }\r\n  }\r\n\r\n  start() {\r\n    this.running = true;\r\n    this.requestAnimationFrame();\r\n    if (this.bodgeMode) this.startBodgeMode();\r\n  }\r\n\r\n  stop() {\r\n    this.running = false;\r\n    if (this._requestID) window.cancelAnimationFrame(this._requestID);\r\n    if (this.bodgeInterval) clearInterval(this.bodgeInterval);\r\n  }\r\n\r\n  requestAnimationFrame() {\r\n    this._requestID = window.requestAnimationFrame(this.onAnimationFrame);\r\n  }\r\n\r\n  onAnimationFrame = () => {\r\n    if (this.calibrating) {\r\n      if (this.calibrationStartTime === null) {\r\n        this.calibrationStartTime = new Date().getTime();\r\n        this.calibrationCurrentFrames = 0;\r\n      } else {\r\n        this.calibrationCurrentFrames += 1;\r\n      }\r\n\r\n      // Calibration complete!\r\n      if (this.calibrationCurrentFrames === this.calibrationFrames) {\r\n        this.calibrating = false;\r\n\r\n        var now = new Date().getTime();\r\n        var delta = now - this.calibrationStartTime;\r\n        var fps = 1000 / (delta / this.calibrationFrames);\r\n\r\n        if (\r\n          fps <= this.desiredFPS - this.calibrationTolerance ||\r\n          fps >= this.desiredFPS + this.calibrationTolerance\r\n        ) {\r\n          console.log(\r\n            `Enabling bodge mode. (Desired FPS is ${\r\n              this.desiredFPS\r\n            }, actual FPS is ${fps})`\r\n          );\r\n          this.startBodgeMode();\r\n        }\r\n      }\r\n    }\r\n\r\n    this.requestAnimationFrame();\r\n\r\n    if (this.running) {\r\n      if (!this.bodgeMode) {\r\n        this.onGenerateFrame();\r\n      }\r\n      this.onWriteFrame();\r\n    }\r\n  };\r\n\r\n  startBodgeMode = () => {\r\n    this.bodgeMode = true;\r\n    this.bodgeInterval = setInterval(this.onBodge, 1000 / this.desiredFPS);\r\n  };\r\n\r\n  onBodge = () => {\r\n    if (this.running) {\r\n      this.onGenerateFrame();\r\n    }\r\n  };\r\n}\r\n","export default class GamepadController {\r\n  constructor(options) {\r\n    this.onButtonDown = options.onButtonDown;\r\n    this.onButtonUp = options.onButtonUp;\r\n    this.gamepadState = [];\r\n    this.buttonCallback = null;\r\n  }\r\n\r\n  disableIfGamepadEnabled = callback => {\r\n    var self = this;\r\n    return (playerId, buttonId) => {\r\n      if (!self.gamepadConfig) {\r\n        return callback(playerId, buttonId);\r\n      }\r\n\r\n      var playerGamepadId = self.gamepadConfig.playerGamepadId;\r\n      if (!playerGamepadId || !playerGamepadId[playerId - 1]) {\r\n        // allow callback only if player is not associated to any gamepad\r\n        return callback(playerId, buttonId);\r\n      }\r\n    };\r\n  };\r\n\r\n  _getPlayerNumberFromGamepad = gamepad => {\r\n    if (this.gamepadConfig.playerGamepadId[0] === gamepad.id) {\r\n      return 1;\r\n    }\r\n\r\n    if (this.gamepadConfig.playerGamepadId[1] === gamepad.id) {\r\n      return 2;\r\n    }\r\n\r\n    return 1;\r\n  };\r\n\r\n  poll = () => {\r\n    const gamepads = navigator.getGamepads\r\n      ? navigator.getGamepads()\r\n      : navigator.webkitGetGamepads();\r\n\r\n    const usedPlayers = [];\r\n\r\n    for (let gamepadIndex = 0; gamepadIndex < gamepads.length; gamepadIndex++) {\r\n      const gamepad = gamepads[gamepadIndex];\r\n      const previousGamepad = this.gamepadState[gamepadIndex];\r\n\r\n      if (!gamepad) {\r\n        continue;\r\n      }\r\n\r\n      if (!previousGamepad) {\r\n        this.gamepadState[gamepadIndex] = gamepad;\r\n        continue;\r\n      }\r\n\r\n      const buttons = gamepad.buttons;\r\n      const previousButtons = previousGamepad.buttons;\r\n\r\n      if (this.buttonCallback) {\r\n        for (let code = 0; code < gamepad.axes.length; code++) {\r\n          const axis = gamepad.axes[code];\r\n          const previousAxis = previousGamepad.axes[code];\r\n\r\n          if (axis === -1 && previousAxis !== -1) {\r\n            this.buttonCallback({\r\n              gamepadId: gamepad.id,\r\n              type: \"axis\",\r\n              code: code,\r\n              value: axis\r\n            });\r\n          }\r\n\r\n          if (axis === 1 && previousAxis !== 1) {\r\n            this.buttonCallback({\r\n              gamepadId: gamepad.id,\r\n              type: \"axis\",\r\n              code: code,\r\n              value: axis\r\n            });\r\n          }\r\n        }\r\n\r\n        for (let code = 0; code < buttons.length; code++) {\r\n          const button = buttons[code];\r\n          const previousButton = previousButtons[code];\r\n          if (button.pressed && !previousButton.pressed) {\r\n            this.buttonCallback({\r\n              gamepadId: gamepad.id,\r\n              type: \"button\",\r\n              code: code\r\n            });\r\n          }\r\n        }\r\n      } else if (this.gamepadConfig) {\r\n        let playerNumber = this._getPlayerNumberFromGamepad(gamepad);\r\n        if (usedPlayers.length < 2) {\r\n          if (usedPlayers.indexOf(playerNumber) !== -1) {\r\n            playerNumber++;\r\n            if (playerNumber > 2) playerNumber = 1;\r\n          }\r\n          usedPlayers.push(playerNumber);\r\n\r\n          if (this.gamepadConfig.configs[gamepad.id]) {\r\n            const configButtons = this.gamepadConfig.configs[gamepad.id]\r\n              .buttons;\r\n\r\n            for (let i = 0; i < configButtons.length; i++) {\r\n              const configButton = configButtons[i];\r\n              if (configButton.type === \"button\") {\r\n                const code = configButton.code;\r\n                const button = buttons[code];\r\n                const previousButton = previousButtons[code];\r\n\r\n                if (button.pressed && !previousButton.pressed) {\r\n                  this.onButtonDown(playerNumber, configButton.buttonId);\r\n                } else if (!button.pressed && previousButton.pressed) {\r\n                  this.onButtonUp(playerNumber, configButton.buttonId);\r\n                }\r\n              } else if (configButton.type === \"axis\") {\r\n                const code = configButton.code;\r\n                const axis = gamepad.axes[code];\r\n                const previousAxis = previousGamepad.axes[code];\r\n\r\n                if (\r\n                  axis === configButton.value &&\r\n                  previousAxis !== configButton.value\r\n                ) {\r\n                  this.onButtonDown(playerNumber, configButton.buttonId);\r\n                }\r\n\r\n                if (\r\n                  axis !== configButton.value &&\r\n                  previousAxis === configButton.value\r\n                ) {\r\n                  this.onButtonUp(playerNumber, configButton.buttonId);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this.gamepadState[gamepadIndex] = {\r\n        buttons: buttons.map(b => {\r\n          return { pressed: b.pressed };\r\n        }),\r\n        axes: gamepad.axes.slice(0)\r\n      };\r\n    }\r\n  };\r\n\r\n  promptButton = f => {\r\n    if (!f) {\r\n      this.buttonCallback = f;\r\n    } else {\r\n      this.buttonCallback = buttonInfo => {\r\n        this.buttonCallback = null;\r\n        f(buttonInfo);\r\n      };\r\n    }\r\n  };\r\n\r\n  loadGamepadConfig = () => {\r\n    var gamepadConfig;\r\n    try {\r\n      gamepadConfig = localStorage.getItem(\"gamepadConfig\");\r\n      if (gamepadConfig) {\r\n        gamepadConfig = JSON.parse(gamepadConfig);\r\n      }\r\n    } catch (e) {\r\n      console.log(\"Failed to get gamepadConfig from localStorage.\", e);\r\n    }\r\n\r\n    this.gamepadConfig = gamepadConfig;\r\n  };\r\n\r\n  setGamepadConfig = gamepadConfig => {\r\n    try {\r\n      localStorage.setItem(\"gamepadConfig\", JSON.stringify(gamepadConfig));\r\n      this.gamepadConfig = gamepadConfig;\r\n    } catch (e) {\r\n      console.log(\"Failed to set gamepadConfig in localStorage\");\r\n    }\r\n  };\r\n\r\n  startPolling = () => {\r\n    if (!(navigator.getGamepads || navigator.webkitGetGamepads)) {\r\n      return { stop: () => {} };\r\n    }\r\n\r\n    let stopped = false;\r\n    const loop = () => {\r\n      if (stopped) return;\r\n\r\n      this.poll();\r\n      requestAnimationFrame(loop);\r\n    };\r\n    requestAnimationFrame(loop);\r\n\r\n    return {\r\n      stop: () => {\r\n        stopped = true;\r\n      }\r\n    };\r\n  };\r\n}\r\n","import { Controller } from \"jsnes\";\r\n\r\n// Mapping keyboard code to [controller, button]\r\nconst KEYS = {\r\n  88: [1, Controller.BUTTON_A, \"X\"], // X\r\n  89: [1, Controller.BUTTON_B, \"Y\"], // Y (Central European keyboard)\r\n  90: [1, Controller.BUTTON_B, \"Z\"], // Z\r\n  17: [1, Controller.BUTTON_SELECT, \"Right Ctrl\"], // Right Ctrl\r\n  13: [1, Controller.BUTTON_START, \"Enter\"], // Enter\r\n  38: [1, Controller.BUTTON_UP, \"Up\"], // Up\r\n  40: [1, Controller.BUTTON_DOWN, \"Down\"], // Down\r\n  37: [1, Controller.BUTTON_LEFT, \"Left\"], // Left\r\n  39: [1, Controller.BUTTON_RIGHT, \"Right\"], // Right\r\n  103: [2, Controller.BUTTON_A, \"Num-7\"], // Num-7\r\n  105: [2, Controller.BUTTON_B, \"Num-9\"], // Num-9\r\n  99: [2, Controller.BUTTON_SELECT, \"Num-3\"], // Num-3\r\n  97: [2, Controller.BUTTON_START, \"Num-1\"], // Num-1\r\n  104: [2, Controller.BUTTON_UP, \"Num-8\"], // Num-8\r\n  98: [2, Controller.BUTTON_DOWN, \"Num-2\"], // Num-2\r\n  100: [2, Controller.BUTTON_LEFT, \"Num-4\"], // Num-4\r\n  102: [2, Controller.BUTTON_RIGHT, \"Num-6\"] // Num-6\r\n};\r\n\r\nexport default class KeyboardController {\r\n  constructor(options) {\r\n    this.onButtonDown = options.onButtonDown;\r\n    this.onButtonUp = options.onButtonUp;\r\n  }\r\n\r\n  loadKeys = () => {\r\n    var keys;\r\n    try {\r\n      keys = localStorage.getItem(\"keys\");\r\n      if (keys) {\r\n        keys = JSON.parse(keys);\r\n      }\r\n    } catch (e) {\r\n      console.log(\"Failed to get keys from localStorage.\", e);\r\n    }\r\n\r\n    this.keys = keys || KEYS;\r\n  };\r\n\r\n  setKeys = newKeys => {\r\n    try {\r\n      localStorage.setItem(\"keys\", JSON.stringify(newKeys));\r\n      this.keys = newKeys;\r\n    } catch (e) {\r\n      console.log(\"Failed to set keys in localStorage\");\r\n    }\r\n  };\r\n\r\n  handleKeyDown = e => {\r\n    var key = this.keys[e.keyCode];\r\n    if (key) {\r\n      this.onButtonDown(key[0], key[1]);\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  handleKeyUp = e => {\r\n    var key = this.keys[e.keyCode];\r\n    if (key) {\r\n      this.onButtonUp(key[0], key[1]);\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  handleKeyPress = e => {\r\n    e.preventDefault();\r\n  };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./Screen.css\";\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\n\r\nclass Screen extends Component {\r\n  render() {\r\n    return (\r\n      <canvas\r\n        className=\"Screen\"\r\n        width={SCREEN_WIDTH}\r\n        height={SCREEN_HEIGHT}\r\n        onMouseDown={this.handleMouseDown}\r\n        onMouseUp={this.props.onMouseUp}\r\n        ref={canvas => {\r\n          this.canvas = canvas;\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.initCanvas();\r\n  }\r\n\r\n  initCanvas() {\r\n    this.context = this.canvas.getContext(\"2d\");\r\n    this.imageData = this.context.getImageData(\r\n      0,\r\n      0,\r\n      SCREEN_WIDTH,\r\n      SCREEN_HEIGHT\r\n    );\r\n\r\n    this.context.fillStyle = \"black\";\r\n    // set alpha to opaque\r\n    this.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\r\n\r\n    // buffer to write on next animation frame\r\n    this.buf = new ArrayBuffer(this.imageData.data.length);\r\n    // Get the canvas buffer in 8bit and 32bit\r\n    this.buf8 = new Uint8ClampedArray(this.buf);\r\n    this.buf32 = new Uint32Array(this.buf);\r\n\r\n    // Set alpha\r\n    for (var i = 0; i < this.buf32.length; ++i) {\r\n      this.buf32[i] = 0xff000000;\r\n    }\r\n  }\r\n\r\n  setBuffer = buffer => {\r\n    var i = 0;\r\n    for (var y = 0; y < SCREEN_HEIGHT; ++y) {\r\n      for (var x = 0; x < SCREEN_WIDTH; ++x) {\r\n        i = y * 256 + x;\r\n        // Convert pixel from NES BGR to canvas ABGR\r\n        this.buf32[i] = 0xff000000 | buffer[i]; // Full alpha\r\n      }\r\n    }\r\n  };\r\n\r\n  writeBuffer = () => {\r\n    this.imageData.data.set(this.buf8);\r\n    this.context.putImageData(this.imageData, 0, 0);\r\n  };\r\n\r\n  fitInParent = () => {\r\n    let parent = this.canvas.parentNode;\r\n    // @ts-ignore\r\n    let parentWidth = parent.clientWidth;\r\n    // @ts-ignore\r\n    let parentHeight = parent.clientHeight;\r\n    let parentRatio = parentWidth / parentHeight;\r\n    let desiredRatio = SCREEN_WIDTH / SCREEN_HEIGHT;\r\n    if (desiredRatio < parentRatio) {\r\n      this.canvas.style.width = `${Math.round(parentHeight * desiredRatio)}px`;\r\n      this.canvas.style.height = `${parentHeight}px`;\r\n    } else {\r\n      this.canvas.style.width = `${parentWidth}px`;\r\n      this.canvas.style.height = `${Math.round(parentWidth / desiredRatio)}px`;\r\n    }\r\n  };\r\n\r\n  screenshot() {\r\n    var img = new Image();\r\n    img.src = this.canvas.toDataURL(\"image/png\");\r\n    return img;\r\n  }\r\n\r\n  handleMouseDown = e => {\r\n    if (!this.props.onMouseDown) return;\r\n    // Make coordinates unscaled\r\n    let scale = SCREEN_WIDTH / parseFloat(this.canvas.style.width);\r\n    let rect = this.canvas.getBoundingClientRect();\r\n    let x = Math.round((e.clientX - rect.left) * scale);\r\n    let y = Math.round((e.clientY - rect.top) * scale);\r\n    this.props.onMouseDown(x, y);\r\n  };\r\n}\r\n\r\nexport default Screen;\r\n","import Raven from \"raven-js\";\r\n\r\nexport const handleError = (error, errorInfo) => {\r\n  console.error(error);\r\n  Raven.captureException(error, { extra: errorInfo });\r\n};\r\n","import RingBuffer from \"ringbufferjs\";\r\nimport { handleError } from \"./utils\";\r\n\r\nexport default class Speakers {\r\n  constructor({ onBufferUnderrun }) {\r\n    this.onBufferUnderrun = onBufferUnderrun;\r\n    this.bufferSize = 8192;\r\n    this.buffer = new RingBuffer(this.bufferSize * 2);\r\n  }\r\n\r\n  start() {\r\n    // Audio is not supported\r\n    if (!window.AudioContext) {\r\n      return;\r\n    }\r\n    this.audioCtx = new window.AudioContext();\r\n    this.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\r\n    this.scriptNode.onaudioprocess = this.onaudioprocess;\r\n    this.scriptNode.connect(this.audioCtx.destination);\r\n  }\r\n\r\n  stop() {\r\n    if (this.scriptNode) {\r\n      this.scriptNode.disconnect(this.audioCtx.destination);\r\n      this.scriptNode.onaudioprocess = null;\r\n      this.scriptNode = null;\r\n    }\r\n    if (this.audioCtx) {\r\n      this.audioCtx.close().catch(handleError);\r\n      this.audioCtx = null;\r\n    }\r\n  }\r\n\r\n  writeSample = (left, right) => {\r\n    if (this.buffer.size() / 2 >= this.bufferSize) {\r\n      console.log(`Buffer overrun`);\r\n    }\r\n    this.buffer.enq(left);\r\n    this.buffer.enq(right);\r\n  };\r\n\r\n  onaudioprocess = e => {\r\n    var left = e.outputBuffer.getChannelData(0);\r\n    var right = e.outputBuffer.getChannelData(1);\r\n    var size = left.length;\r\n\r\n    // We're going to buffer underrun. Attempt to fill the buffer.\r\n    if (this.buffer.size() < size * 2 && this.onBufferUnderrun) {\r\n      this.onBufferUnderrun(this.buffer.size(), size * 2);\r\n    }\r\n\r\n    try {\r\n      var samples = this.buffer.deqN(size * 2);\r\n    } catch (e) {\r\n      // onBufferUnderrun failed to fill the buffer, so handle a real buffer\r\n      // underrun\r\n\r\n      // ignore empty buffers... assume audio has just stopped\r\n      var bufferSize = this.buffer.size() / 2;\r\n      if (bufferSize > 0) {\r\n        console.log(`Buffer underrun (needed ${size}, got ${bufferSize})`);\r\n      }\r\n      for (var j = 0; j < size; j++) {\r\n        left[j] = 0;\r\n        right[j] = 0;\r\n      }\r\n      return;\r\n    }\r\n    for (var i = 0; i < size; i++) {\r\n      left[i] = samples[i * 2];\r\n      right[i] = samples[i * 2 + 1];\r\n    }\r\n  };\r\n}\r\n","import Raven from \"raven-js\";\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { NES } from \"jsnes\";\r\n\r\nimport FrameTimer from \"./FrameTimer\";\r\nimport GamepadController from \"./GamepadController\";\r\nimport KeyboardController from \"./KeyboardController\";\r\nimport Screen from \"./Screen\";\r\nimport Speakers from \"./Speakers\";\r\n\r\n/*\r\n * Runs the emulator.\r\n *\r\n * The only UI is a canvas element. It assumes it is a singleton in various ways\r\n * (binds to window, keyboard, speakers, etc).\r\n */\r\nclass Emulator extends Component {\r\n  render() {\r\n    return (\r\n      <Screen\r\n        ref={screen => {\r\n          this.screen = screen;\r\n        }}\r\n        onGenerateFrame={() => {\r\n          this.nes.frame();\r\n        }}\r\n        onMouseDown={(x, y) => {\r\n          this.nes.zapperMove(x, y);\r\n          this.nes.zapperFireDown();\r\n        }}\r\n        onMouseUp={() => {\r\n          this.nes.zapperFireUp();\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Initial layout\r\n    this.fitInParent();\r\n\r\n    this.speakers = new Speakers({\r\n      onBufferUnderrun: (actualSize, desiredSize) => {\r\n        if (this.props.paused) {\r\n          return;\r\n        }\r\n        // Skip a video frame so audio remains consistent. This happens for\r\n        // a variety of reasons:\r\n        // - Frame rate is not quite 60fps, so sometimes buffer empties\r\n        // - Page is not visible, so requestAnimationFrame doesn't get fired.\r\n        //   In this case emulator still runs at full speed, but timing is\r\n        //   done by audio instead of requestAnimationFrame.\r\n        // - System can't run emulator at full speed. In this case it'll stop\r\n        //    firing requestAnimationFrame.\r\n        console.log(\r\n          \"Buffer underrun, running another frame to try and catch up\"\r\n        );\r\n\r\n        this.nes.frame();\r\n        // desiredSize will be 2048, and the NES produces 1468 samples on each\r\n        // frame so we might need a second frame to be run. Give up after that\r\n        // though -- the system is not catching up\r\n        if (this.speakers.buffer.size() < desiredSize) {\r\n          console.log(\"Still buffer underrun, running a second frame\");\r\n          this.nes.frame();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.nes = new NES({\r\n      onFrame: this.screen.setBuffer,\r\n      onStatusUpdate: console.log,\r\n      onAudioSample: this.speakers.writeSample\r\n    });\r\n\r\n    // For debugging. ([\"nes\"] instead of .nes to avoid VS Code type errors.)\r\n    window[\"nes\"] = this.nes;\r\n\r\n    this.frameTimer = new FrameTimer({\r\n      onGenerateFrame: Raven.wrap(this.nes.frame),\r\n      onWriteFrame: Raven.wrap(this.screen.writeBuffer)\r\n    });\r\n\r\n    // Set up gamepad and keyboard\r\n    this.gamepadController = new GamepadController({\r\n      onButtonDown: this.nes.buttonDown,\r\n      onButtonUp: this.nes.buttonUp\r\n    });\r\n\r\n    this.gamepadController.loadGamepadConfig();\r\n    this.gamepadPolling = this.gamepadController.startPolling();\r\n\r\n    this.keyboardController = new KeyboardController({\r\n      onButtonDown: this.gamepadController.disableIfGamepadEnabled(\r\n        this.nes.buttonDown\r\n      ),\r\n      onButtonUp: this.gamepadController.disableIfGamepadEnabled(\r\n        this.nes.buttonUp\r\n      )\r\n    });\r\n\r\n    // Load keys from localStorage (if they exist)\r\n    this.keyboardController.loadKeys();\r\n\r\n    document.addEventListener(\"keydown\", this.keyboardController.handleKeyDown);\r\n    document.addEventListener(\"keyup\", this.keyboardController.handleKeyUp);\r\n    document.addEventListener(\r\n      \"keypress\",\r\n      this.keyboardController.handleKeyPress\r\n    );\r\n\r\n    this.nes.loadROM(this.props.romData);\r\n    this.start();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.stop();\r\n\r\n    // Unbind keyboard\r\n    document.removeEventListener(\r\n      \"keydown\",\r\n      this.keyboardController.handleKeyDown\r\n    );\r\n    document.removeEventListener(\"keyup\", this.keyboardController.handleKeyUp);\r\n    document.removeEventListener(\r\n      \"keypress\",\r\n      this.keyboardController.handleKeyPress\r\n    );\r\n\r\n    // Stop gamepad\r\n    this.gamepadPolling.stop();\r\n\r\n    window[\"nes\"] = undefined;\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.paused !== prevProps.paused) {\r\n      if (this.props.paused) {\r\n        this.stop();\r\n      } else {\r\n        this.start();\r\n      }\r\n    }\r\n\r\n    // TODO: handle changing romData\r\n  }\r\n\r\n  start = () => {\r\n    this.frameTimer.start();\r\n    this.speakers.start();\r\n    this.fpsInterval = setInterval(() => {\r\n      console.log(`FPS: ${this.nes.getFPS()}`);\r\n    }, 1000);\r\n  };\r\n\r\n  stop = () => {\r\n    this.frameTimer.stop();\r\n    this.speakers.stop();\r\n    clearInterval(this.fpsInterval);\r\n  };\r\n\r\n  /*\r\n   * Fill parent element with screen. Typically called if parent element changes size.\r\n   */\r\n  fitInParent() {\r\n    this.screen.fitInParent();\r\n  }\r\n}\r\n\r\nEmulator.propTypes = {\r\n  paused: PropTypes.bool,\r\n  romData: PropTypes.string.isRequired\r\n};\r\n\r\nexport default Emulator;\r\n","import React, { Component } from \"react\";\r\nimport { Button, Progress } from \"reactstrap\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport config from \"./config\";\r\nimport ControlsModal from \"./ControlsModal\";\r\nimport Emulator from \"./Emulator\";\r\nimport RomLibrary from \"./RomLibrary\";\r\n\r\nimport \"./RunPage.css\";\r\n\r\nfunction loadBinary(path, callback, handleProgress) {\r\n  var req = new XMLHttpRequest();\r\n  req.open(\"GET\", path);\r\n  req.overrideMimeType(\"text/plain; charset=x-user-defined\");\r\n  req.onload = function() {\r\n    if (this.status === 200) {\r\n      if (req.responseText.match(/^<!doctype html>/i)) {\r\n        // Got HTML back, so it is probably falling back to index.html due to 404\r\n        return callback(new Error(\"Page not found\"));\r\n      }\r\n\r\n      callback(null, this.responseText);\r\n    } else if (this.status === 0) {\r\n      // Aborted, so ignore error\r\n    } else {\r\n      callback(new Error(req.statusText));\r\n    }\r\n  };\r\n  req.onerror = function() {\r\n    callback(new Error(req.statusText));\r\n  };\r\n  req.onprogress = handleProgress;\r\n  req.send();\r\n  return req;\r\n}\r\n\r\n/*\r\n * The UI for the emulator. Also responsible for loading ROM from URL or file.\r\n */\r\nclass RunPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      romName: null,\r\n      romData: null,\r\n      running: false,\r\n      paused: false,\r\n      controlsModalOpen: false,\r\n      loading: true,\r\n      loadedPercent: 3,\r\n      error: null\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"RunPage\">\r\n        <nav\r\n          className=\"navbar navbar-expand\"\r\n          ref={el => {\r\n            this.navbar = el;\r\n          }}\r\n        >\r\n          <ul className=\"navbar-nav\" style={{ width: \"200px\" }}>\r\n            <li className=\"navitem\">\r\n              <Link to=\"/\" className=\"nav-link\">\r\n                &lsaquo; Back\r\n              </Link>\r\n            </li>\r\n          </ul>\r\n          <ul className=\"navbar-nav ml-auto mr-auto\">\r\n            <li className=\"navitem\">\r\n              <span className=\"navbar-text mr-3\">{this.state.romName}</span>\r\n            </li>\r\n          </ul>\r\n          <ul className=\"navbar-nav\" style={{ width: \"200px\" }}>\r\n            <li className=\"navitem\">\r\n              <Button\r\n                outline\r\n                color=\"primary\"\r\n                onClick={this.toggleControlsModal}\r\n                className=\"mr-3\"\r\n              >\r\n                Controls\r\n              </Button>\r\n              <Button\r\n                outline\r\n                color=\"primary\"\r\n                onClick={this.handlePauseResume}\r\n                disabled={!this.state.running}\r\n              >\r\n                {this.state.paused ? \"Resume\" : \"Pause\"}\r\n              </Button>\r\n            </li>\r\n          </ul>\r\n        </nav>\r\n\r\n        {this.state.error ? (\r\n          this.state.error\r\n        ) : (\r\n          <div\r\n            className=\"screen-container\"\r\n            ref={el => {\r\n              this.screenContainer = el;\r\n            }}\r\n          >\r\n            {this.state.loading ? (\r\n              <Progress\r\n                value={this.state.loadedPercent}\r\n                style={{\r\n                  position: \"absolute\",\r\n                  width: \"70%\",\r\n                  left: \"15%\",\r\n                  top: \"48%\"\r\n                }}\r\n              />\r\n            ) : this.state.romData ? (\r\n              <Emulator\r\n                romData={this.state.romData}\r\n                paused={this.state.paused}\r\n                ref={emulator => {\r\n                  this.emulator = emulator;\r\n                }}\r\n              />\r\n            ) : null}\r\n\r\n            {/*TODO: lift keyboard and gamepad state up */}\r\n            {this.state.controlsModalOpen && (\r\n              <ControlsModal\r\n                isOpen={this.state.controlsModalOpen}\r\n                toggle={this.toggleControlsModal}\r\n                keys={this.emulator.keyboardController.keys}\r\n                setKeys={this.emulator.keyboardController.setKeys}\r\n                promptButton={this.emulator.gamepadController.promptButton}\r\n                gamepadConfig={this.emulator.gamepadController.gamepadConfig}\r\n                setGamepadConfig={\r\n                  this.emulator.gamepadController.setGamepadConfig\r\n                }\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"resize\", this.layout);\r\n    this.layout();\r\n    this.load();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"resize\", this.layout);\r\n    if (this.currentRequest) {\r\n      this.currentRequest.abort();\r\n    }\r\n  }\r\n\r\n  load = () => {\r\n    if (this.props.match.params.slug) {\r\n      const slug = this.props.match.params.slug;\r\n      const isLocalROM = /^local-/.test(slug);\r\n      const romHash = slug.split(\"-\")[1];\r\n      const romInfo = isLocalROM\r\n        ? RomLibrary.getRomInfoByHash(romHash)\r\n        : config.ROMS[slug];\r\n\r\n      if (!romInfo) {\r\n        this.setState({ error: `No such ROM: ${slug}` });\r\n        return;\r\n      }\r\n\r\n      if (isLocalROM) {\r\n        this.setState({ romName: romInfo.name });\r\n        const localROMData = localStorage.getItem(\"blob-\" + romHash);\r\n        this.handleLoaded(localROMData);\r\n      } else {\r\n        this.setState({ romName: romInfo.description });\r\n        this.currentRequest = loadBinary(\r\n          romInfo.url,\r\n          (err, data) => {\r\n            if (err) {\r\n              this.setState({ error: `Error loading ROM: ${err.message}` });\r\n            } else {\r\n              this.handleLoaded(data);\r\n            }\r\n          },\r\n          this.handleProgress\r\n        );\r\n      }\r\n    } else if (this.props.location.state && this.props.location.state.file) {\r\n      let reader = new FileReader();\r\n      reader.readAsBinaryString(this.props.location.state.file);\r\n      reader.onload = e => {\r\n        this.currentRequest = null;\r\n        this.handleLoaded(reader.result);\r\n      };\r\n    } else {\r\n      this.setState({ error: \"No ROM provided\" });\r\n    }\r\n  };\r\n\r\n  handleProgress = e => {\r\n    if (e.lengthComputable) {\r\n      this.setState({ loadedPercent: (e.loaded / e.total) * 100 });\r\n    }\r\n  };\r\n\r\n  handleLoaded = data => {\r\n    this.setState({ running: true, loading: false, romData: data });\r\n  };\r\n\r\n  handlePauseResume = () => {\r\n    this.setState({ paused: !this.state.paused });\r\n  };\r\n\r\n  layout = () => {\r\n    let navbarHeight = parseFloat(window.getComputedStyle(this.navbar).height);\r\n    this.screenContainer.style.height = `${window.innerHeight -\r\n      navbarHeight}px`;\r\n    if (this.emulator) {\r\n      this.emulator.fitInParent();\r\n    }\r\n  };\r\n\r\n  toggleControlsModal = () => {\r\n    this.setState({ controlsModalOpen: !this.state.controlsModalOpen });\r\n  };\r\n}\r\n\r\nexport default RunPage;\r\n","import React, { Component } from \"react\";\r\nimport GoogleAnalytics from \"react-ga\";\r\nimport { BrowserRouter, Route } from \"react-router-dom\";\r\nimport ListPage from \"./ListPage\";\r\nimport RunPage from \"./RunPage\";\r\nimport config from \"./config\";\r\nimport { handleError } from \"./utils\";\r\nimport \"./App.css\";\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { error: null };\r\n    if (config.GOOGLE_ANALYTICS_CODE) {\r\n      GoogleAnalytics.initialize(config.GOOGLE_ANALYTICS_CODE);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.error) {\r\n      return (\r\n        <div className=\"container my-4\">\r\n          <div className=\"row justify-content-center\">\r\n            <div className=\"col-md-8\">\r\n              Oops - there has been an error. It has been logged to the console.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <BrowserRouter>\r\n        <div className=\"App\">\r\n          <Route exact path=\"/\" component={ListPage} />\r\n          <Route exact path=\"/run\" component={RunPage} />\r\n          <Route exact path=\"/run/:slug\" component={RunPage} />\r\n          <Route path=\"/\" render={this.recordPageview} />\r\n        </div>\r\n      </BrowserRouter>\r\n    );\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    this.setState({ error });\r\n    handleError(error, errorInfo);\r\n  }\r\n\r\n  recordPageview = ({ location }) => {\r\n    GoogleAnalytics.pageview(location.pathname);\r\n    return null;\r\n  };\r\n}\r\n\r\nexport default App;\r\n","import Raven from \"raven-js\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport config from \"./config\";\r\nimport \"./index.scss\";\r\n\r\nif (config.SENTRY_URI) {\r\n  Raven.config(config.SENTRY_URI).install();\r\n}\r\n\r\nRaven.context(function() {\r\n  ReactDOM.render(<App />, document.getElementById(\"root\"));\r\n});\r\n"],"sourceRoot":""}